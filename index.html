<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spaghetti Factory VIP Register</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    body { font-family: 'Kanit', sans-serif; background-color: #FDFBF7; }
    .brand-color { color: #005C5C; }
    .bg-brand { background-color: #005C5C; }
    
    /* Custom Checkbox Design */
    .checkbox-wrapper input:checked + div {
      background-color: #005C5C;
      border-color: #005C5C;
    }
    .checkbox-wrapper input:checked + div svg {
      display: block;
    }
    
    /* Button States */
    .btn-disabled {
      background-color: #CBD5E1; /* สีเทา */
      cursor: not-allowed;
      transform: none !important;
    }
    .btn-active {
      background-color: #005C5C;
      cursor: pointer;
    }
    .btn-active:hover { background-color: #004545; }

    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      box-shadow: 0 10px 40px -10px rgba(0, 92, 92, 0.15);
      border-radius: 24px;
      border: 1px solid rgba(0, 92, 92, 0.1);
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

  <div class="glass-card w-full max-w-md overflow-hidden relative">
    <div class="pt-8 pb-6 px-8 text-center bg-white relative z-10">
      
      <img src="logo.png" alt="Spaghetti Factory" class="h-24 mx-auto mb-4 object-contain">
      
      <h2 class="text-2xl font-bold brand-color">VIP Registration</h2>
      <p class="text-gray-400 text-sm mt-1">ลงทะเบียนเพื่อรับสิทธิพิเศษสำหรับ VIP</p>
    </div>

    <div class="px-8 pb-10 bg-white">
      <form id="regForm" onsubmit="submitForm(event)" class="space-y-4">
        
        <div>
          <label class="text-xs font-semibold text-gray-500 uppercase ml-1">Full Name</label>
          <input type="text" name="fullName" required class="w-full mt-1 px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#005C5C] outline-none">
        </div>

        <div>
            <label class="text-xs font-semibold text-gray-500 uppercase ml-1">Line ID</label>
            <input type="text" name="lineId" required class="w-full mt-1 px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#005C5C] outline-none">
        </div>

        <div>
          <label class="text-xs font-semibold text-gray-500 uppercase ml-1">Email</label>
          <input type="email" name="email" required class="w-full mt-1 px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#005C5C] outline-none">
        </div>

        <div>
          <label class="text-xs font-semibold text-gray-500 uppercase ml-1">Address</label>
          <textarea name="address" required rows="3" class="w-full mt-1 px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#005C5C] outline-none resize-none"></textarea>
        </div>

        <div class="pt-2">
            <label class="checkbox-wrapper flex items-start cursor-pointer group">
              <input type="checkbox" id="pdpaCheck" class="hidden" onchange="toggleSubmitButton()">
              <div class="w-5 h-5 border-2 border-gray-300 rounded flex items-center justify-center mt-0.5 mr-3 transition-colors duration-200 bg-white group-hover:border-[#005C5C]">
                <svg class="w-3 h-3 text-white hidden pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
              </div>
              <div class="text-sm text-gray-500 select-none">
                ข้าพเจ้ายอมรับ <a href="#" onclick="showPDPA(event)" class="text-[#005C5C] font-semibold underline hover:text-[#004545]">ข้อตกลงและนโยบายความเป็นส่วนตัว (PDPA)</a> ในการเก็บรวบรวมข้อมูลเพื่อใช้ในการให้บริการ
              </div>
            </label>
        </div>

        <div class="pt-2">
          <button type="submit" id="submitBtn" disabled 
                  class="w-full btn-disabled text-white font-bold py-3.5 px-4 rounded-xl shadow-lg transition-all duration-300 flex justify-center items-center gap-2">
            <span>ยืนยันการลงทะเบียน</span>
          </button>
        </div>
      </form>
    </div>
    
    <div class="bg-gray-50 py-3 text-center border-t border-gray-100">
      <p class="text-xs text-gray-400">© Spaghetti Factory VIP Club</p>
    </div>
  </div>

  <script>
    // *** อย่าลืมใส่ URL ของคุณที่นี่ ***
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzwkwc-eu5UKXwKkm7TslEv0U11IKAyNK_pktxTw8dbA3aeJfdW6M6FWvq5J5ej9xUy/exec';

    // ฟังก์ชันเปิด/ปิด ปุ่ม Submit
    function toggleSubmitButton() {
        const checkbox = document.getElementById('pdpaCheck');
        const btn = document.getElementById('submitBtn');
        
        if (checkbox.checked) {
            // ถ้าติ๊กถูก -> เปิดปุ่ม
            btn.disabled = false;
            btn.classList.remove('btn-disabled');
            btn.classList.add('btn-active');
            btn.classList.add('transform', 'active:scale-95'); // เพิ่ม Effect กดเด้งๆ
        } else {
            // ถ้าเอาออก -> ปิดปุ่ม
            btn.disabled = true;
            btn.classList.add('btn-disabled');
            btn.classList.remove('btn-active');
            btn.classList.remove('transform', 'active:scale-95');
        }
    }

    // ฟังก์ชันแสดง Popup PDPA (SweetAlert2)
    function showPDPA(e) {
        e.preventDefault(); // กันไม่ให้ลิงก์ดีดไปหน้าอื่น
        Swal.fire({
            title: '<span style="color:#005C5C">นโยบายความเป็นส่วนตัว</span>',
            html: `
                <div style="text-align: left; font-size: 0.9em; line-height: 1.6; color: #555;">
                    <p><b>1. การเก็บรวบรวมข้อมูล:</b> ทางร้าน Spaghetti Factory จะเก็บรวบรวมข้อมูล ชื่อ, เบอร์โทร, และที่อยู่ เพื่อใช้ในการสมัครสมาชิกและจัดส่งสินค้าเท่านั้น</p>
                    <br>
                    <p><b>2. การเปิดเผยข้อมูล:</b> เราจะไม่เปิดเผยข้อมูลของท่านแก่บุคคลภายนอก ยกเว้นบริษัทขนส่งที่เกี่ยวข้อง</p>
                    <br>
                    <p><b>3. สิทธิ์ของเจ้าของข้อมูล:</b> ท่านสามารถขอยกเลิกหรือลบข้อมูลได้ตลอดเวลาโดยติดต่อผ่าน Line Official</p>
                </div>
            `,
            confirmButtonText: 'รับทราบและยอมรับ',
            confirmButtonColor: '#005C5C',
            width: '600px',
            scrollbarPadding: false
        }).then((result) => {
            if (result.isConfirmed) {
                // ถ้ากดรับทราบใน Popup จะติ๊กถูกให้อัตโนมัติ (UX เสริม)
                const checkbox = document.getElementById('pdpaCheck');
                checkbox.checked = true;
                toggleSubmitButton();
            }
        });
    }

    function submitForm(e) {
      e.preventDefault();
      const btn = document.getElementById('submitBtn');
      const form = document.getElementById('regForm');
      
      const originalText = btn.innerHTML;
      btn.innerHTML = 'กำลังบันทึก...';
      btn.disabled = true;
      btn.classList.add('opacity-70'); // ลดความเข้มลงนิดหน่อยตอนโหลด

      const formData = {
        fullName: form.fullName.value,
        lineId: form.lineId.value,
        email: form.email.value,
        address: form.address.value
      };

      fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'text/plain;charset=utf-8' // แก้ไขตามคำแนะนำเพื่อให้ส่งผ่าน
        },
        body: JSON.stringify(formData)
      })
      .then(() => {
        Swal.fire({
          icon: 'success',
          title: 'เรียบร้อย!',
          text: 'บันทึกข้อมูลสำเร็จ',
          confirmButtonColor: '#005C5C'
        }).then(() => {
          form.reset();
          // Reset ปุ่มกลับไปเป็นสถานะ Disabled หลังส่งเสร็จ
          btn.innerHTML = originalText;
          btn.classList.remove('opacity-70');
          toggleSubmitButton(); 
        });
      })
      .catch(error => {
        console.error('Error:', error);
        Swal.fire({
          icon: 'error',
          title: 'เกิดข้อผิดพลาด',
          text: 'ไม่สามารถติดต่อ Server ได้'
        });
        btn.innerHTML = originalText;
        toggleSubmitButton(); // เช็คสถานะปุ่มใหม่
      });
    }
  </script>
</body>
</html>